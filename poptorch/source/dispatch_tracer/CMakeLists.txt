
set(CMAKE_POSITION_INDEPENDENT_CODE ON)

# Generates the C++ interface to add each pytorch op.
add_subdirectory(scripts)


# This can be built without the MLIR component.
set(MLIR_SOURCE_FILE "dispatchers/MLIRDispatch.cpp")


add_library(dispatch_tracer STATIC
  RegisterAtenOverloads.cpp
  CommonHelperFunctions.cpp
  dispatchers/IDispatch.cpp
  dispatchers/JitDispatch.cpp
  dispatchers/MLIRDispatchUtils.cpp
  dispatchers/MLIRDispatch.cpp
  dispatchers/CompilerDispatchTable.cpp
  ValueMapper.cpp
  Tensor.cpp
  TypeInferenceHandler.cpp
)

target_link_libraries(dispatch_tracer
  PUBLIC
    torch
  PRIVATE
    poptorch_internal_headers
    poptorch_logging
    poptorch_compiler
    popart_compiler
    generated_supported_ops_interface
    poptorch_err
)

# Add the build folder of the dialect so we can pick up the autogenerated header files.
target_include_directories(dispatch_tracer SYSTEM PRIVATE 
              "${PROJECT_BINARY_DIR}/poptorch_compiler/dialect/include/dialect")

set_property(TARGET dispatch_tracer PROPERTY CXX_STANDARD 17)
